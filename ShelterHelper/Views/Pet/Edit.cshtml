@model ShelterHelper.Models.Pet

@{
    ViewData["Title"] = "Edit Pet";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1 class="mb-4">Edit Pet Information</h1>

            <form asp-controller="Pet" asp-action="Edit" method="post" enctype="multipart/form-data">
                <!-- Hidden ID -->
                <input type="hidden" asp-for="Id">

                <!-- Validation Summary -->
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Please fix the following errors:</strong>
                        <div asp-validation-summary="All"></div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <!-- Pet Name -->
                <div class="mb-3">
                    <label for="name" class="form-label">Pet Name <span class="text-danger">*</span></label>
                    <input type="text" asp-for="Name" class="form-control" 
                           placeholder="Enter pet's name" maxlength="100" required>
                    <span asp-validation-for="Name" class="invalid-feedback"></span>
                </div>

                <!-- Species -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="species" class="form-label">Species <span class="text-danger">*</span></label>
                            <select asp-for="Species" class="form-select" required>
                                <option value="">-- Select Species --</option>
                                <option value="Dog">üêï Dog</option>
                                <option value="Cat">üê± Cat</option>
                                <option value="Rabbit">üê∞ Rabbit</option>
                                <option value="Bird">üê¶ Bird</option>
                                <option value="Other">‚ùì Other</option>
                            </select>
                            <span asp-validation-for="Species" class="invalid-feedback"></span>
                        </div>
                    </div>

                    <!-- Breed -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="breed" class="form-label">Breed</label>
                            <input type="text" asp-for="Breed" class="form-control" 
                                   placeholder="e.g., Labrador Retriever" maxlength="100">
                            <span asp-validation-for="Breed" class="invalid-feedback"></span>
                        </div>
                    </div>
                </div>

                <!-- Age -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="age" class="form-label">Age (years)</label>
                            <input type="number" asp-for="Age" class="form-control" 
                                   placeholder="0" min="0" max="50">
                            <span asp-validation-for="Age" class="invalid-feedback"></span>
                        </div>
                    </div>

                    <!-- Adoption Status -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <div class="form-check">
                                <input type="checkbox" asp-for="IsAdopted" class="form-check-input" id="isAdopted">
                                <label class="form-check-label" for="isAdopted">
                                    Adopted
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="mb-3">
                    <label for="notes" class="form-label">Notes & Description</label>
                    <textarea asp-for="Notes" class="form-control" 
                              placeholder="Describe the pet's personality, health, or special needs..." 
                              rows="4" maxlength="500"></textarea>
                    <small class="form-text text-muted">
                        <span id="noteCount">@(Model?.Notes?.Length ?? 0)</span>/500 characters
                    </small>
                    <span asp-validation-for="Notes" class="invalid-feedback"></span>
                </div>

                <!-- Pet of the Week -->
                <div class="mb-3">
                    <div class="form-check">
                        <input type="checkbox" asp-for="IsPetOfTheWeek" class="form-check-input" id="isPetOfTheWeek">
                        <label class="form-check-label" for="isPetOfTheWeek">
                            Feature as Pet of the Week üåü
                        </label>
                    </div>
                </div>

                <!-- Current Image -->
                @if (!string.IsNullOrEmpty(Model?.ImagePath))
                {
                    <div class="mb-3">
                        <label class="form-label">Current Photo</label>
                        <div class="card">
                            <img src="@Model.ImagePath" class="card-img" style="max-height: 200px; object-fit: cover;" 
                                 alt="@Model.Name">
                        </div>
                        <small class="text-muted d-block mt-2">Upload a new photo to replace the current one</small>
                    </div>
                }

                <!-- Image Upload -->
                <div class="mb-3">
                    <label for="petPhoto" class="form-label">Update Pet Photo</label>
                    <input type="file" name="petPhoto" id="petPhoto" class="form-control" 
                           accept="image/*" aria-label="Upload new pet photo">
                    <small class="form-text text-muted d-block mt-2">
                        Supported formats: JPG, PNG, GIF, WebP. Max size: 5MB
                    </small>
                    <div id="imagePreview" class="mt-3"></div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg flex-grow-1">
                        <span class="me-2">üíæ</span>Save Changes
                    </button>
                    <a asp-controller="Pet" asp-action="Index" class="btn btn-secondary btn-lg">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Image preview
        document.getElementById('petPhoto').addEventListener('change', function(e) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';
                    img.className = 'rounded';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Character counter for notes
        document.getElementById('notes').addEventListener('input', function(e) {
            document.getElementById('noteCount').textContent = e.target.value.length;
        });
    </script>
}